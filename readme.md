# 前言：
    感谢大家使用本开源项目，本项目旨在快速帮助大家构建一个自己的QQ机器人

    本项目部署的qq机器人拥有以下能力：
        1.智能断句：利用AI能力为输出打上断句标签，合理断句，既可以保证长内容回复的完整性，
            也可以避免AI回复长段内容
        2.智能意图判断：利用AI能力给输出打上标签，实现不同回复内容经过特殊函数处理，例如
            文本转语音，AI绘图等
        3.拥有语音回复，AI绘画回复等常见的回复形式，让回复更加多样化

    本项目站在巨人的肩膀上，使用了其他的一些开源项目，大家可以给对应项目点一个star哦~
# 准备：

1. 首先，下载并安装NTQQ（一种新架构的QQ电脑端）：
   [NTQQ下载链接](https://im.qq.com/pcqq/index.shtml)

2. 安装LLonebot的NTQQ插件：
   [NTQQ插件链接](https://github.com/LLOneBot/LLOneBot)
   安装方法：[点击查看](https://llonebot.github.io/zh-CN/guide/getting-started)
   如果是Windows系统，注意下载如下名称的较新版本exe：
    ![NTQQ插件安装图](source/1.png)

3. 配置LLonebot插件：
   安装好插件后，打开ntqq进入插件设置
   填写各种信息（千万不要忘记填写端口号）后，**注意保存！！！**
    ![NTQQ插件安装图](source/2.png)

# 开始：

1. 配置：
   进入此文件
   
    ![NTQQ插件安装图](source/3.png)
    ![NTQQ插件安装图](source/4.png)

   解释：
   - `trigger`后面填入触发词，如果用户发送的消息里包含这个词，会触发回复。
   - `system_prompt`后面填的就是AI人设，建议参考默认人设的格式，效果会更好。
   - `chat_model`后面填模型名称，切忌自己编造，需查看模型官方开发者文档，按照官方模型名称严格填写，此项将影响请求模型对象。
   - `chat_url`后面填对应型号模型的请求地址，需要查看对应模型官方的API开发文档，找到对应的地址。
   - 其他的配置项大家应该可以看懂是什么，画图模型配置类比文本模型。

2. 修改：
   - 进入`Qbot.py`源代码编辑页面。
   - 将`root_id`的变量内容替换为管理员的QQ号码。
   - 将`folder_path`的变量内容替换为本项目`user`文件夹在本机的绝对路径，如：`D:\\qbot-main\\user\\`。

3. 启动：
   安装必要的库：
   打开命令行（win+r，输入cmd并回车），先cd到Qbot-main根目录，然后输入以下命令：
   ```cmd
   pip install -r requirements.txt
   ```
   保持NTQQ的运行状态，然后使用`python Qbot.py`或双击Qbot.py即可完成启动。

   （遇到问题可以联系开发者幻日QQ：2141073363）

# 补充：

由于我的服务器可能无法支撑大量的语音合成请求，所以大家需要自己部署本地语音合成。本地语音合成可以使用AI桌宠的语音合成服务（即箱庭GPT-Sovits整合包，使用花火模型，双击starttts.bat即可），二者接口格式一样。

[箱庭GPT-Sovits整合包项目](https://github.com/X-T-E-R/GPT-SoVITS-Inference)
[箱庭GPT-Sovits整合包文档](https://www.yuque.com/xter/zibxlp/kkicvpiogcou5lgp)

部署好之后，只需要启动其中的后端并在根目录按照格式建立空文件夹（[Qbot根目录]\data\voice）即可，本项目会自动使用本地语音合成进行语音输出。

**如果启用了绘画或者语音合成等需要发送文件到QQ的服务时，需要同时启动另一个名为`file.py`的程序。**
**注意：需要等待`Qbot.py`加载完记忆再启动，否则有概率导致`Qbot.py`无法收发信息！！！**

# 命令说明:
1. `#sudo`：用于获取私信验证码，作为管理员账户失效时的备用验证方案。将私信获得到的6位验证码与需要管理员权限执行的命令在同一条消息中发送，命令将被正常执行。
2. `#暂停`：暂停程序收发消息，仅保留命令功能，需要管理员权限。
3. `#继续`：继续程序收发消息，需要管理员权限。
4. `#reset`：清空当前聊天（群聊/私聊）短期记忆，群聊需要管理员权限。
5. `#clear`：删除个人（群聊/私聊）长期记忆，如果在群聊中发送将删除机器人对此人在群聊中的长期记忆，如果在私聊中发送将删除机器人对此人在私聊中的长期记忆。
6. `#erase`：删除所有长期记忆，需要管理员权限。

# 常见问题：
1. 程序闪退：很可能是因为`set.json`的编码格式不对，推测因为经常使用windows记事本编辑导致编码格式自动转换为UTF-8 with BOM，此处建议安装VScode，然后用VScode打开json，在右下角点击`UTF-8 with BOM`，在顶部的选项栏中选择`保存为编码格式`，点击`UTF-8`即可。
2. 无法接收发送消息且无报错：建议检查QQ插件设置项填写是否完整，尤其是请求地址。
3. 语音合成失败：玄学问题，建议关了重开。
4. 语音合成提示无需重复启动（桌宠用户常见问题）：建议把所有Python后台都删掉再试试（推荐）；或者直接修改`starttts.bat`，将其后台进程检测判断逻辑删除即可（不建议）。
5. “由于远程主机积极拒绝，无法连接”：可能是请求次数过多，超过了每分钟或每天的请求次数限制，等一等就好。
6. `break limitless turn`：正常行为。AI之间防刷屏的代码。

# 请求：
***觉得本项目有用的话就点一个star吧~***